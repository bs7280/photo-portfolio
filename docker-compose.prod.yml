version: '3.8'

services:
  backend:
    image: ghcr.io/${GITHUB_USERNAME}/photography-portfolio-backend:latest
    ports:
      - "5001:5001"
    environment:
      - PORT=5001
      - EDIT_MODE=false
      - USE_CDN=true
      - CDN_BASE_URL=${CDN_BASE_URL}
      - DATABASE_PATH=/app/photos_metadata.db
      - BACKEND_URL=${BACKEND_URL}
      # R2 credentials (read-only access for metadata)
      - R2_ENDPOINT_URL=${R2_ENDPOINT_URL}
      - R2_ACCESS_KEY_ID=${R2_ACCESS_KEY_ID}
      - R2_SECRET_ACCESS_KEY=${R2_SECRET_ACCESS_KEY}
      - R2_BUCKET_NAME=${R2_BUCKET_NAME}
    volumes:
      # Persist database (with EXIF data)
      - database:/app/data
    restart: unless-stopped

  frontend:
    image: ghcr.io/${GITHUB_USERNAME}/photography-portfolio-frontend:latest
    ports:
      - "80:80"
    environment:
      - VITE_API_URL=${BACKEND_URL}/api
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  database:
